<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spot the AI — Mastery Lab</title>
    <style>
        :root {
            --color-primary: #007bff;
            --color-secondary: #f0f4f8;
            --color-background: #ffffff;
            --color-surface: #ffffff;
            --color-bg-2: #f8f9fa;
            --color-text: #212529;
            --color-text-secondary: #6c757d;
            --color-border: #dee2e6;
            --color-success: #28a745;
            --color-error: #dc3545;
            --color-warning: #ffc107;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: var(--font-family-base); background-color: var(--color-background); color: var(--color-text); margin: 0; line-height: 1.5; }
        main { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }

        /* --- BUTTONS & GENERAL UI --- */
        .btn { display: inline-block; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; cursor: pointer; text-align: center; border: 2px solid transparent; transition: all 0.2s ease-in-out; }
        .btn--primary { background-color: var(--color-primary); color: white; }
        .btn--secondary { background-color: var(--color-secondary); color: var(--color-text); }
        .btn--outline { border-color: var(--color-border); background-color: transparent; color: var(--color-text); }
        .btn:hover { opacity: 0.85; transform: translateY(-1px); }
        .quiz-header { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 0 16px 0; }
        
        /* --- MAIN MENU --- */
        .lab-hero { text-align: center; padding: 40px 20px 20px; margin-bottom: 2rem; }
        .hero-title { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .hero-explain { font-size: 1.1rem; color: var(--color-text-secondary); max-width: 600px; margin: 1rem auto; }
        .learn-more-container { text-align: center; margin-bottom: 2.5rem; }
        .detection-list { display: grid; gap: 16px; }
        .detection-card { background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 12px; padding: 24px; text-decoration: none; color: inherit; transition: transform 0.2s ease, box-shadow 0.2s ease; display: block; }
        .detection-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        .card-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .detection-card h3 { margin: 0; font-size: 1.25rem; }
        .detection-desc { margin: 0; color: var(--color-text-secondary); }
        .card-score { font-size: 0.9rem; font-weight: 600; color: var(--color-text-secondary); margin-top: 12px; }

        /* --- PROGRESS BAR --- */
        .progress-track { background-color: #e9ecef; border-radius: 99px; height: 8px; width: 100px; overflow: hidden; }
        .progress-fill { background-color: var(--color-primary); height: 100%; width: 0%; border-radius: 99px; transition: width 0.3s ease; }
        .fixed-progress-container { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--color-surface); padding: 12px 24px; box-shadow: 0 -2px 10px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 16px; z-index: 50; }
        .fixed-progress-container .progress-track { width: 100%; }
        
        /* --- SIDE-BY-SIDE QUIZ --- */
        .comparison-container { display: flex; gap: 20px; margin-bottom: 20px; }
        .comparison-panel { flex: 1; border: 3px solid var(--color-border); border-radius: 12px; background-color: var(--color-surface); cursor: pointer; transition: all 0.2s ease; overflow: hidden; }
        .comparison-panel:not(.disabled):hover { border-color: var(--color-primary); transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        .comparison-panel.disabled { cursor: not-allowed; }
        .comparison-panel .content-box { padding: 24px; min-height: 250px; font-size: 1.1rem; line-height: 1.6; white-space: pre-wrap; }
        .comparison-panel .image-box { height: 400px; background-size: cover; background-position: center; }
        .comparison-panel.correct { border-color: var(--color-success) !important; }
        .comparison-panel.incorrect { border-color: var(--color-error) !important; }
        #prompt-container { text-align: center; padding: 16px; background-color: var(--color-secondary); border-radius: 12px; margin-bottom: 20px; font-style: italic; }
        #feedbackSection { margin-bottom: 80px; }
        .explanation-box { background-color: var(--color-bg-2); padding: 16px 24px; margin-top: 16px; border-radius: 12px; border-top: 3px solid var(--color-warning); }
        .explanation-box::before { content: '💡 The Verdict'; font-weight: 700; font-size: 1.1em; display: block; margin-bottom: 8px; color: var(--color-warning); }
        .explanation-box strong { color: var(--color-primary); }
        .explanation-box .explanation-detail { margin-bottom: 12px; }

        /* --- UPGRADED VIDEO QUIZ --- */
        .video-quiz-container { max-width: 800px; margin: auto; }
        .video-player-wrapper { position: relative; margin-bottom: 16px; }
        #sampleVideo { width: 100%; border-radius: 8px; background-color: #000; }
        .hint-container { margin-bottom: 16px; text-align: center; }
        #hint-box { background-color: var(--color-secondary); padding: 12px; border-radius: 8px; margin-top: 10px; font-style: italic; }
        .choice-row { display: flex; gap: 16px; justify-content: center; }
        .choice-box { flex: 1; padding: 16px; border: 2px solid var(--color-border); border-radius: 12px; text-align: center; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .choice-box:not(.disabled):hover { border-color: var(--color-primary); }
        .choice-box.disabled { cursor: not-allowed; }
        .choice-box.correct { background-color: rgba(40, 167, 69, 0.15) !important; border-color: var(--color-success) !important; color: var(--color-success) !important; }
        .choice-box.incorrect { background-color: rgba(220, 53, 69, 0.15) !important; border-color: var(--color-error) !important; color: var(--color-error) !important; }
        #feedbackSectionVideo button { margin-top: 16px; width: 100%; }

        /* --- FULL-SCREEN LEARN MODAL --- */
        .modal { position: fixed; inset: 0; z-index: 1000; display: flex; background: var(--color-surface); flex-direction: column; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .modal.active { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 1px solid var(--color-border); flex-shrink: 0; }
        .modal-header h2 { margin: 0; font-size: 1.5rem; }
        .modal-close-btn { font-size: 2rem; font-weight: bold; background: none; border: none; cursor: pointer; color: var(--color-text-secondary); }
        .modal-body { display: flex; flex-grow: 1; overflow: hidden; }
        .modal-sidebar { width: 240px; border-right: 1px solid var(--color-border); padding: 16px; overflow-y: auto; flex-shrink: 0; }
        .modal-sidebar-btn { display: block; width: 100%; text-align: left; padding: 12px 16px; background: none; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-bottom: 8px; }
        .modal-sidebar-btn.active { background-color: var(--color-secondary); color: var(--color-primary); }
        .modal-content-area { flex-grow: 1; padding: 32px; overflow-y: auto; position: relative; }
        .learn-slide { display: none; }
        .learn-slide.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-category { font-size: 0.9rem; font-weight: 700; color: var(--color-text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;}
        .learn-slide h3 { font-size: 2rem; color: var(--color-primary); margin-top: 0; }
        .learn-slide p { font-size: 1.1rem; line-height: 1.7; max-width: 80ch; }
        .example-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 24px; }
        .example-grid img {
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            object-position: center;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }
        .example-grid p { font-size: 1rem; color: var(--color-text-secondary); margin-top: 8px; }
        .slide-nav-arrows { position: absolute; top: 50%; width: calc(100% - 240px); left: 240px; transform: translateY(-50%); display: flex; justify-content: space-between; padding: 0 32px; pointer-events: none; }
        .slide-nav-arrow { background-color: rgba(255,255,255,0.8); border: 1px solid var(--color-border); width: 50px; height: 50px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; pointer-events: all; transition: all 0.2s ease; }
        .slide-nav-arrow:hover { background-color: white; transform: scale(1.1); }
        
        @media (max-width: 768px) {
            .comparison-container { flex-direction: column; }
            .modal-body { flex-direction: column; }
            .modal-sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--color-border); display: flex; overflow-x: auto; padding: 8px; }
            .modal-sidebar-btn { flex-shrink: 0; }
            .slide-nav-arrows { display: none; }
        }
    </style>
</head>
<body>

    <main id="main-menu" class="view">
        <section class="lab-hero">
            <h1 class="hero-title">Learn How to Spot AI</h1>
            <p class="hero-explain">Sharpen your instincts with interactive challenges and in-depth guides.</p>
            <div class="learn-more-container"><button class="btn btn--primary" id="mainLearnBtn">🚀 Enter Learning Center</button></div>
        </section>
        <div class="detection-list">
            <a class="detection-card" href="#" data-quiz="text">
                <div class="card-row"><h3>AI Text Detection</h3><div class="progress-track"><div class="progress-fill"></div></div></div>
                <p class="detection-desc">Can you spot the AI-written text next to a human's?</p>
                <div class="card-score" data-score-key="spot-text-score">Best Score: N/A</div>
            </a>
            <a class="detection-card" href="#" data-quiz="image">
                <div class="card-row"><h3>AI Image Detection</h3><div class="progress-track"><div class="progress-fill"></div></div></div>
                <p class="detection-desc">Identify the AI-generated image when compared to a real photo.</p>
                <div class="card-score" data-score-key="spot-image-score">Best Score: N/A</div>
            </a>
            <a class="detection-card" href="#" data-quiz="video">
                <div class="card-row"><h3>AI Video Detection</h3><div class="progress-track"><div class="progress-fill"></div></div></div>
                <p class="detection-desc">Spot deepfakes and manipulated video content with interactive hints.</p>
                <div class="card-score" data-score-key="spot-video-score">Best Score: N/A</div>
            </a>
        </div>
    </main>

    <main id="quiz-view" class="view hidden">
        <div class="quiz-header">
            <button class="btn btn--outline" id="backToMenuBtn">&larr; Back</button>
            <h3 id="quizTitle" style="margin: 0; text-align: center; flex-grow: 1;"></h3>
            <button class="btn btn--secondary" id="inQuizLearnBtn">🎓 Learning Center</button>
        </div>
        <div id="questionHeader" style="text-align:center; margin: 0 0 14px 0; font-weight:600;">Question <span id="questionCounter">1</span> of <span id="totalQ">5</span></div>
        <div id="prompt-container">Click the panel you think was generated by AI.</div>
        <div class="comparison-container">
            <div class="comparison-panel" id="panelLeft"><div class="content-box" id="textLeft"></div><div class="image-box" id="imgLeft"></div></div>
            <div class="comparison-panel" id="panelRight"><div class="content-box" id="textRight"></div><div class="image-box" id="imgRight"></div></div>
        </div>
        <div id="feedbackSection"></div>
    </main>
    
    <main id="video-quiz-view" class="view hidden">
         <div class="quiz-header">
            <button class="btn btn--outline" id="backToMenuBtnVideo">&larr; Back</button>
            <h3 style="margin: 0; text-align: center; flex-grow: 1;">AI Video Detection</h3>
            <button class="btn btn--secondary" id="inVideoQuizLearnBtn">🎓 Learning Center</button>
        </div>
        <div id="videoQuestionHeader" style="text-align:center; margin: 0 0 14px 0; font-weight:600;">Question <span id="videoQuestionCounter">1</span> of <span id="videoTotalQ">3</span></div>
        <div class="video-quiz-container">
            <div class="video-player-wrapper"><video id="sampleVideo" controls loop muted playsinline></video></div>
            <div class="hint-container"><button class="btn btn--secondary" id="hintBtn">Show Hint 💡</button><div id="hint-box" class="hidden"></div></div>
            <div class="choice-row"><div class="choice-box" id="choiceReal">Authentic Footage</div><div class="choice-box" id="choiceAI">Manipulated / AI</div></div>
            <div id="feedbackSectionVideo"></div>
        </div>
    </main>

    <div id="learnModal" class="modal">
        <div class="modal-header">
            <h2>Learning Center</h2>
            <button class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <aside class="modal-sidebar">
                <button class="modal-sidebar-btn" data-slide="hands">🖐️ AI Hands & Anatomy</button>
                <button class="modal-sidebar-btn" data-slide="text">🔤 Weird Text & Patterns</button>
                <button class="modal-sidebar-btn" data-slide="unreal">✨ Unnatural Perfection</button>
                <button class="modal-sidebar-btn" data-slide="faces">👁️ Uncanny Faces</button>
                <button class="modal-sidebar-btn" data-slide="physics">🌍 Impossible Physics</button>
                <button class="modal-sidebar-btn" data-slide="warp">🌀 Background Warping</button>
            </aside>
            <div class="modal-content-area">
                <div class="slide-nav-arrows">
                    <button id="prevSlideBtn" class="slide-nav-arrow">&larr;</button>
                    <button id="nextSlideBtn" class="slide-nav-arrow">&rarr;</button>
                </div>
                <div class="learn-slide" data-slide="hands">
                    <p class="slide-category">For Images</p>
                    <h3>🖐️ AI Hands & Anatomy</h3>
                    <p>Hands are incredibly complex, and AI models often get them wrong. This is one of the most reliable and classic giveaways of an AI-generated image. Look for an incorrect number of fingers, joints that bend in impossible ways, or fingers that merge together unnaturally.</p>
                    <div class="example-grid">
                        <div><img src="assets/images/learn_hands_1.jpg" alt="AI hand with six fingers"><p>Notice the extra finger and the strange, waxy texture of the skin.</p></div>
                        <div><img src="assets/images/learn_hands_2.jpg" alt="AI hand merging with an object"><p>Here, the fingers seem to blend unnaturally with the object being held.</p></div>
                    </div>
                </div>
                <div class="learn-slide" data-slide="text">
                    <p class="slide-category">For Images & Written Text</p>
                    <h3>🔤 Weird Text & Patterns</h3>
                    <p>AI can replicate the *appearance* of text but struggles with forming coherent words and letters. In AI images, look at signs, books, or clothing. You'll often find a jumble of nonsensical characters that look like a foreign language but aren't.</p>
                    <div class="example-grid">
                        <div><img src="assets/images/learn_text_1.jpg" alt="Garbled AI text on a sign"><p>The letters on this sign have the shape of text but form no recognizable words.</p></div>
                        <div><img src="assets/images/learn_text_2.jpg" alt="AI text on a book spine"><p>Book spines are a common place to find this artifact. The text appears melted or distorted.</p></div>
                    </div>
                </div>
                <div class="learn-slide" data-slide="unreal">
                    <p class="slide-category">For Images & Video</p>
                    <h3>✨ Unnatural Perfection</h3>
                    <p>The real world has texture, flaws, and imperfections. AI-generated content often looks too clean or too perfect. Skin might lack pores, surfaces can have an unnatural plastic-like sheen, and symmetry can be flawlessly perfect in a way that feels artificial.</p>
                    <div class="example-grid">
                        <div><img src="assets/images/learn_unreal_1.jpg" alt="AI portrait with perfect skin"><p>This person's skin is perfectly smooth, lacking any of the natural blemishes or pores of real skin.</p></div>
                        <div><img src="assets/images/learn_unreal_2.jpg" alt="Perfectly symmetrical AI object"><p>Objects in AI images can be so symmetrical that they look like 3D models rather than real-life items.</p></div>
                    </div>
                </div>
                <div class="learn-slide" data-slide="faces">
                    <p class="slide-category">For Images & Video</p>
                    <h3>👁️ Uncanny Faces</h3>
                    <p>This is a major clue in AI video. Facial features may be slightly asymmetrical, eyes might not point in the same direction, or blinking can be unnatural (too frequent or too rare). In deepfakes, the "pasted-on" face may not quite match the head's lighting or movement.</p>
                    <div class="example-grid">
                        <div><img src="assets/images/learn_faces_1.jpg" alt="Deepfake face with bad lighting"><p>The lighting on the face doesn't match the lighting of the surrounding environment.</p></div>
                        <div><img src="assets/images/learn_faces_2.jpg" alt="AI video still with poor lip sync"><p>The shape of the mouth doesn't match the sound being made (a key video clue).</p></div>
                    </div>
                </div>
                <div class="learn-slide" data-slide="physics">
                    <p class="slide-category">For Images & Video</p>
                    <h3>🌍 Impossible Physics</h3>
                    <p>AI doesn't truly understand the laws of physics. Look for things that defy logic. Shadows might fall in the wrong direction from the light source, reflections in water or glass might be incorrect, or objects might appear to float or bend in impossible ways.</p>
                    <div class="example-grid">
                        <div><img src="assets/images/learn_physics_1.jpg" alt="AI image with incorrect shadows"><p>The shadow of the object is inconsistent with the direction of the sun.</p></div>
                        <div><img src="assets/images/learn_physics_2.jpg" alt="AI image with a bad reflection"><p>The reflection in the mirror is distorted and doesn't accurately represent the scene.</p></div>
                    </div>
                </div>
                <div class="learn-slide" data-slide="warp">
                    <p class="slide-category">For Video</p>
                    <h3>🌀 Background Warping</h3>
                    <p>A common artifact in AI video. As a person or object moves, the AI has to constantly regenerate the background behind them. This can cause straight lines in the background (like doorways or poles) to subtly shimmer, bend, or warp around the moving subject.</p>
                    <div class="example-grid">
                        <div><img src="assets/images/learn_warp_1.jpg" alt="Example of background warping in AI video"><p>As the person walks, the door frame behind them appears to ripple or distort.</p></div>
                        <div><img src="assets/images/learn_warp_2.jpg" alt="Another example of AI warping"><p>The pattern on the wall seems to shift unnaturally around the subject's silhouette.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="progress-bar-container" class="fixed-progress-container hidden">
        <div style="flex:1"><div class="progress-track"><div class="progress-fill" id="progressFill"></div></div></div>
        <div id="progressPercent">0%</div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const quizData = {
        text: { 
            title: 'AI Text Detection', 
            localStorageKey: 'spot-text-progress-v3',
            samples: [
                { ai: { content: "I am writing to express my profound disappointment regarding the recent cancellation of our dinner plans. I had allocated significant time in my schedule for this engagement and was looking forward to our discourse.", explanation: "This text uses overly formal and dramatic language like 'profound disappointment' and 'discourse,' which is unnatural for a casual text. The sentence structure is complex and sounds like it was written for a formal document, not a friendly message." }, human: { content: "hey!! so bummed you had to cancel tonight, was really looking forward to it. let's def reschedule soon!", explanation: "This feels authentic due to its casual tone, use of slang ('so bummed,' 'def'), multiple exclamation points for emphasis, and lack of formal capitalization. It reads exactly how a friend would text." } },
                { ai: { content: "This product is a paradigm of innovation. Its multifunctional capabilities and streamlined user interface provide an unparalleled user experience. I highly recommend it for its superior performance.", explanation: "This review is filled with generic, positive-sounding marketing buzzwords ('paradigm of innovation,' 'unparalleled user experience') but provides zero specific details about what the product actually does or how it was used. It lacks a personal story." }, human: { content: "ok so I bought this thing last week and at first the battery life seemed kinda bad but after the first charge it's been amazing. Used it all day yesterday at the park with no issues.", explanation: "The authenticity here comes from the specific, slightly negative detail ('battery life seemed kinda bad at first'). Real reviews often mention a complete experience, including initial doubts, and provide a concrete example of use ('at the park')." } },
                { ai: { content: "I am thrilled to announce a new chapter in my professional journey. I am grateful for the past and excited for the future. I look forward to leveraging my skills in this new role.", explanation: "This is a classic AI template. It uses common clichés ('new chapter,' 'leveraging my skills') and expresses vague positive sentiment without any unique personality or specific details about the job, the company, or personal feelings." }, human: { content: "BIG NEWS! After 5 years at my old job (gonna miss you, desk plant!), I'm starting a new role as a Project Manager next Monday. Super nervous but also really excited. Wish me luck!", explanation: "The human touch is obvious here. The all-caps opener, the specific personal joke ('gonna miss you, desk plant!'), and the expression of genuine, mixed emotions ('Super nervous but also really excited') make it feel real and unique." } },
                { ai: { content: "Our team synergized effectively, leveraging our core competencies to achieve our quarterly objectives. We will continue to iterate on our strategic initiatives moving forward.", explanation: "This sentence is overloaded with corporate jargon ('synergized,' 'core competencies,' 'strategic initiatives'). While a human might use one of these terms, stringing them all together makes the text sound robotic and impersonal, like an automated report." }, human: { content: "That meeting was rough but I think we finally figured out the logo problem. Jen had a great idea about the color. Think we're on the right track now.", explanation: "This message is direct, informal, and functional. It references a specific problem ('the logo problem') and a specific person ('Jen'), which grounds the conversation in a real, shared context. The language is simple and action-oriented." } },
                { ai: { content: "The sunset painted the sky in hues of orange and purple. The majestic mountains stood tall against the vibrant canvas, creating a picturesque scene of profound beauty.", explanation: "This description uses very generic and clichéd imagery ('painted the sky,' 'majestic mountains,' 'vibrant canvas'). It reads like a template for describing a sunset rather than a personal observation of a specific, unique moment." }, human: { content: "The sky looked kinda weird tonight, all pink and grey. There was one cloud that looked exactly like a giant rabbit, it was wild.", explanation: "The authenticity shines through in the specific, quirky details. Using words like 'kinda weird' and seeing a unique shape in a cloud ('a giant rabbit') is a highly personal and imaginative observation that an AI is unlikely to generate." } }
            ] 
        },
        image: { 
            title: 'AI Image Detection', 
            localStorageKey: 'spot-image-progress-v3',
            samples: [
                { ai: { src: 'assets/images/ai_image_1.jpg', explanation: "The most glaring error is the anatomy of the hands. AI models famously struggle with the complexity of hands, often adding extra fingers, creating impossible joints, or giving the skin an unnatural, plastic-like texture as seen here." }, human: { src: 'assets/images/human_image_1.jpg', explanation: "This photo feels authentic due to its natural imperfections. The lighting creates realistic shadows and highlights, the skin has texture, and the focus is not uniformly perfect across the entire image, mimicking how a real camera works." } },
                { ai: { src: 'assets/images/ai_image_2.jpg', explanation: "The text on the signs in the background is a dead giveaway. While it mimics the shape and flow of letters, it's a nonsensical jumble of characters. AI can create the 'idea' of text but fails at rendering coherent words in complex scenes." }, human: { src: 'assets/images/human_image_2.jpg', explanation: "Even though the background is out of focus, the text on the signs has a logical structure and form consistent with real words. The overall scene has a natural depth of field and complexity that is difficult for AI to replicate perfectly." } },
                { ai: { src: 'assets/images/ai_image_3.jpg', explanation: "This image falls into the 'uncanny valley.' The subject's expression is vacant and lacks genuine emotion. Furthermore, the skin is perfectly flawless, and the lighting is so even and clean that it looks more like a 3D render than a candid photograph." }, human: { src: 'assets/images/human_image_3.jpg', explanation: "The authenticity comes from the candid nature of the shot. The subject's expression is genuine, the lighting creates natural and slightly uneven shadows, and small details like stray hairs or creases in clothing add to the realism." } },
                { ai: { src: 'assets/images/ai_image_4.jpg', explanation: "This image breaks the laws of physics. The reflection in the water is distorted and doesn't accurately mirror the shape, color, or lighting of the objects on the shore. AI often fails to render physically accurate reflections and shadows." }, human: { src: 'assets/images/human_image_4.jpg', explanation: "The physics here are consistent. The reflection in the water, while disturbed by ripples, is a believable mirror of the landscape. The shadows are cast in a uniform direction, consistent with a single light source like the sun." } },
                { ai: { src: 'assets/images/ai_image_5.jpg', explanation: "Look closely at the edges where different objects meet. Here, the subject's clothing seems to blend or morph into the background in a strange, unnatural way. AI can struggle with defining clear boundaries in complex compositions." }, human: { src: 'assets/images/human_image_5.jpg', explanation: "This photo is believable due to its detailed and distinct textures. The fabric of the clothing looks different from the texture of the wall behind it, and the edges between objects are sharp and clear, as they would be in reality." } }
            ]
        },
        video: { 
            title: 'AI Video Detection', 
            localStorageKey: 'spot-video-progress-v3',
            samples: [
                { src: 'assets/videos/video_quiz_1.mp4', label: 'ai', hint: "Pay close attention to the person's skin texture and blinking pattern.", explanation: "<strong>This is AI-generated.</strong> Correct! The most significant clue is the unnaturally smooth, almost waxy skin texture that lacks the subtle variations and imperfections of a real human face. Additionally, the person's blinking rate is slightly too slow and mechanical, a common trait that places the video in the 'uncanny valley'." },
                { src: 'assets/videos/video_quiz_2.mp4', label: 'ai', hint: "Watch the vertical poles in the background as the main subject moves past them.", explanation: "<strong>This is AI-generated.</strong> You spotted it! As the subject moves, the straight vertical lines of the poles in the background subtly shimmer and distort. This 'background warping' is a tell-tale sign that an AI is struggling to separate the foreground subject from its environment in real-time." },
                { src: 'assets/videos/video_quiz_3.mp4', label: 'ai', hint: "Look at the object's reflection in the puddles on the ground.", explanation: "<strong>This is AI-generated.</strong> Excellent catch. The reflection in the puddles is inconsistent and doesn't accurately mirror the object's movement, shape, or lighting. AI often fails to correctly render complex physics like reflections, providing a clear clue that the scene is not real." }
            ] 
        }
    };
    
    const app = {
        currentView: 'main-menu', currentQuiz: null, currentIndex: 0, correctCount: 0, totalQuestions: 0, correctSide: null, currentSlideIndex: 0,

        elements: {
            views: document.querySelectorAll('.view'),
            mainLearnBtn: document.getElementById('mainLearnBtn'),
            backToMenuBtn: document.getElementById('backToMenuBtn'), backToMenuBtnVideo: document.getElementById('backToMenuBtnVideo'),
            quizView: document.getElementById('quiz-view'), quizTitle: document.getElementById('quizTitle'), questionCounter: document.getElementById('questionCounter'), totalQ: document.getElementById('totalQ'), promptContainer: document.getElementById('prompt-container'), panelLeft: document.getElementById('panelLeft'), panelRight: document.getElementById('panelRight'), textLeft: document.getElementById('textLeft'), textRight: document.getElementById('textRight'), imgLeft: document.getElementById('imgLeft'), imgRight: document.getElementById('imgRight'), feedbackSection: document.getElementById('feedbackSection'), inQuizLearnBtn: document.getElementById('inQuizLearnBtn'),
            videoQuizView: document.getElementById('video-quiz-view'), sampleVideo: document.getElementById('sampleVideo'), videoQuestionCounter: document.getElementById('videoQuestionCounter'), videoTotalQ: document.getElementById('videoTotalQ'), choiceReal: document.getElementById('choiceReal'), choiceAI: document.getElementById('choiceAI'), feedbackSectionVideo: document.getElementById('feedbackSectionVideo'), inVideoQuizLearnBtn: document.getElementById('inVideoQuizLearnBtn'), hintBtn: document.getElementById('hintBtn'), hintBox: document.getElementById('hint-box'),
            progressBar: document.getElementById('progress-bar-container'), progressFill: document.getElementById('progressFill'), progressPercent: document.getElementById('progressPercent'),
            learnModal: document.getElementById('learnModal'), modalCloseBtn: document.querySelector('.modal-close-btn'), modalSidebarBtns: document.querySelectorAll('.modal-sidebar-btn'), slides: document.querySelectorAll('.learn-slide'), prevSlideBtn: document.getElementById('prevSlideBtn'), nextSlideBtn: document.getElementById('nextSlideBtn'),
        },

        init() {
            this.updateMenuProgress();
            this.attachEventListeners();
            this.elements.learnModal.classList.add('hidden');
            this.elements.learnModal.style.transform = '';
        },
        
        attachEventListeners() {
            document.querySelectorAll('.detection-card').forEach(card => card.addEventListener('click', (e) => { e.preventDefault(); this.startQuiz(card.dataset.quiz); }));
            this.elements.backToMenuBtn.addEventListener('click', () => this.showView('main-menu'));
            this.elements.backToMenuBtnVideo.addEventListener('click', () => this.showView('main-menu'));
            this.elements.mainLearnBtn.addEventListener('click', () => this.showLearnModal('hands'));
            this.elements.inQuizLearnBtn.addEventListener('click', () => this.showLearnModal(this.currentQuiz === 'text' ? 'text' : 'hands'));
            this.elements.inVideoQuizLearnBtn.addEventListener('click', () => this.showLearnModal('faces'));
            this.elements.panelLeft.addEventListener('click', () => this.handleSideBySideAnswer('left'));
            this.elements.panelRight.addEventListener('click', () => this.handleSideBySideAnswer('right'));
            this.elements.choiceReal.addEventListener('click', () => this.handleVideoAnswer('real'));
            this.elements.choiceAI.addEventListener('click', () => this.handleVideoAnswer('ai'));
            this.elements.hintBtn.addEventListener('click', () => this.toggleHint());
            this.elements.modalCloseBtn.addEventListener('click', () => this.hideLearnModal());
            this.elements.prevSlideBtn.addEventListener('click', () => this.changeSlide(-1));
            this.elements.nextSlideBtn.addEventListener('click', () => this.changeSlide(1));
            this.elements.modalSidebarBtns.forEach(btn => btn.addEventListener('click', () => this.goToSlide(btn.dataset.slide)));
            document.addEventListener('keydown', (e) => {
                if(this.elements.learnModal.classList.contains('active')){
                    if(e.key === 'ArrowRight') this.changeSlide(1);
                    if(e.key === 'ArrowLeft') this.changeSlide(-1);
                    if(e.key === 'Escape') this.hideLearnModal();
                }
            });
        },
        
        showView(viewId) {
            this.currentView = viewId;
            this.elements.views.forEach(view => view.classList.toggle('hidden', view.id !== viewId));
            this.elements.progressBar.classList.add('hidden');
            if (viewId === 'main-menu') this.updateMenuProgress();
        },
        
        startQuiz(quizId) {
            // BUG FIX: Reset UI from any previous completion state
            this.elements.videoQuizView.querySelector('.video-quiz-container').classList.remove('hidden');
            this.elements.quizView.querySelector('.comparison-container').classList.remove('hidden');
            this.elements.promptContainer.classList.remove('hidden');
            // End of Bug Fix section
            
            if (!quizData[quizId]) return;
            this.currentQuiz = quizId; this.currentIndex = 0; this.correctCount = 0;
            this.totalQuestions = quizData[quizId].samples.length;
            const hasSeenGuide = localStorage.getItem(`hasSeen${quizId}Guide`);
            if (!hasSeenGuide) {
                const firstSlideMap = { text: 'text', image: 'hands', video: 'faces' };
                this.showLearnModal(firstSlideMap[quizId]);
                localStorage.setItem(`hasSeen${quizId}Guide`, 'true');
            }
            this.elements.progressBar.classList.remove('hidden'); this.updateProgressDisplay();
            if (quizId === 'video') {
                this.elements.videoTotalQ.textContent = this.totalQuestions; this.loadVideoSample(); this.showView('video-quiz-view');
            } else {
                this.elements.quizTitle.textContent = quizData[quizId].title; this.elements.totalQ.textContent = this.totalQuestions; this.loadSideBySideSample(); this.showView('quiz-view');
            }
        },
        
        loadSideBySideSample() {
            if (this.currentIndex >= this.totalQuestions) { this.showCompletionScreen(); return; }
            const samplePair = quizData[this.currentQuiz].samples[this.currentIndex];
            this.elements.feedbackSection.innerHTML = '';
            ['panelLeft', 'panelRight'].forEach(p => this.elements[p].className = 'comparison-panel');
            this.elements.promptContainer.textContent = "Click the panel you think was generated by AI.";
            this.elements.questionCounter.textContent = this.currentIndex + 1;
            this.correctSide = Math.random() < 0.5 ? 'left' : 'right';
            const humanSide = this.correctSide === 'left' ? 'right' : 'left';
            const sides = { [this.correctSide]: samplePair.ai, [humanSide]: samplePair.human };
            if (this.currentQuiz === 'text') {
                this.elements.textLeft.textContent = sides.left.content; this.elements.textRight.textContent = sides.right.content;
                this.elements.imgLeft.style.display = 'none'; this.elements.imgRight.style.display = 'none'; this.elements.textLeft.style.display = 'block'; this.elements.textRight.style.display = 'block';
            } else {
                this.elements.imgLeft.style.backgroundImage = `url(${sides.left.src})`; this.elements.imgRight.style.backgroundImage = `url(${sides.right.src})`;
                this.elements.imgLeft.style.display = 'block'; this.elements.imgRight.style.display = 'block'; this.elements.textLeft.style.display = 'none'; this.elements.textRight.style.display = 'none';
            }
        },
        
        handleSideBySideAnswer(chosenSide) {
            if (this.elements.panelLeft.classList.contains('disabled')) return;
            this.elements.panelLeft.classList.add('disabled'); this.elements.panelRight.classList.add('disabled');
            const isCorrect = (chosenSide === this.correctSide); if (isCorrect) this.correctCount++;
            this.elements[chosenSide === 'left' ? 'panelLeft' : 'panelRight'].classList.add(isCorrect ? 'correct' : 'incorrect');
            if (!isCorrect) this.elements[this.correctSide === 'left' ? 'panelLeft' : 'panelRight'].classList.add('correct');
            this.elements.promptContainer.textContent = isCorrect ? "Correct!" : "Not quite! Here's the AI one.";
            const samplePair = quizData[this.currentQuiz].samples[this.currentIndex];
            this.elements.feedbackSection.innerHTML = `<div class="explanation-box"><div class="explanation-detail"><strong>AI Example Analysis:</strong> ${samplePair.ai.explanation}</div><div class="explanation-detail"><strong>Human Example Analysis:</strong> ${samplePair.human.explanation}</div></div><button class="btn btn--primary" id="nextBtn">Next</button>`;
            document.getElementById('nextBtn').addEventListener('click', () => { this.currentIndex++; this.loadSideBySideSample(); });
            this.updateProgressDisplay();
        },

        loadVideoSample() {
            if (this.currentIndex >= this.totalQuestions) { this.showCompletionScreen(); return; }
            const sample = quizData.video.samples[this.currentIndex];
            this.elements.feedbackSectionVideo.innerHTML = '';
            this.elements.choiceAI.className = 'choice-box'; this.elements.choiceReal.className = 'choice-box';
            this.elements.videoQuestionCounter.textContent = this.currentIndex + 1;
            this.elements.sampleVideo.src = sample.src;
            this.elements.hintBox.textContent = sample.hint;
            this.elements.hintBox.classList.add('hidden');
            this.elements.hintBtn.classList.remove('hidden');
            this.elements.sampleVideo.play().catch(()=>{});
        },
        
        handleVideoAnswer(choice) {
            if(this.elements.choiceAI.classList.contains('disabled')) return;
            this.elements.choiceAI.classList.add('disabled'); this.elements.choiceReal.classList.add('disabled');
            this.elements.hintBtn.classList.add('hidden'); this.elements.hintBox.classList.add('hidden');
            const sample = quizData.video.samples[this.currentIndex]; const isCorrect = (choice === sample.label); if(isCorrect) this.correctCount++;
            this.elements[choice === 'ai' ? 'choiceAI' : 'choiceReal'].classList.add(isCorrect ? 'correct' : 'incorrect');
            if(!isCorrect) this.elements[sample.label === 'ai' ? 'choiceAI' : 'choiceReal'].classList.add('correct');
            this.elements.feedbackSectionVideo.innerHTML = `<div class="explanation-box">${sample.explanation}</div><button class="btn btn--primary" id="nextVideoBtn">Next</button>`;
            document.getElementById('nextVideoBtn').addEventListener('click', () => { this.currentIndex++; this.loadVideoSample(); });
            this.updateProgressDisplay();
        },

        toggleHint() { this.elements.hintBox.classList.toggle('hidden'); },

        showCompletionScreen() {
            const completionHtml = `<div style="padding:48px; text-align:center;"><h2>Quiz Complete!</h2><p style="font-size: 1.2rem;">You correctly identified <strong>${this.correctCount}</strong> out of <strong>${this.totalQuestions}</strong>.</p></div>`;
            if (this.currentQuiz === 'video') {
                this.elements.videoQuizView.querySelector('.video-quiz-container').classList.add('hidden');
                this.elements.videoQuizView.insertAdjacentHTML('beforeend', `<div class="completion-message">${completionHtml}</div>`);
            } else {
                this.elements.quizView.querySelector('.comparison-container').classList.add('hidden');
                this.elements.promptContainer.innerHTML = completionHtml;
                this.elements.questionHeader.classList.add('hidden');
            }
            try { localStorage.setItem(quizData[this.currentQuiz].localStorageKey, '100'); } catch(e) {}
        },
        
        updateProgressDisplay() {
            const pct = this.totalQuestions > 0 ? Math.round((this.correctCount / this.totalQuestions) * 100) : 0;
            this.elements.progressFill.style.width = pct + '%';
            this.elements.progressPercent.textContent = pct + '%';
            if (!this.currentQuiz) return;
            try { localStorage.setItem(quizData[this.currentQuiz].localStorageKey, String(pct)); } catch(e) {}
        },
        
        updateMenuProgress() {
            document.querySelectorAll('.detection-card').forEach(card => {
                const quizId = card.dataset.quiz; if (!quizId || !quizData[quizId]) return;
                const key = quizData[quizId].localStorageKey; const fill = card.querySelector('.progress-fill');
                try {
                    const pct = parseInt(localStorage.getItem(key) || '0', 10);
                    fill.style.width = Math.min(100, Math.max(0, pct)) + '%';
                } catch(e) { fill.style.width = '0%'; }
            });
        },
        
        showLearnModal(slideId = 'hands') {
            this.elements.learnModal.classList.remove('hidden');
            setTimeout(() => this.elements.learnModal.classList.add('active'), 10);
            this.goToSlide(slideId);
        },
        
        hideLearnModal() {
            this.elements.learnModal.classList.remove('active');
            setTimeout(() => this.elements.learnModal.classList.add('hidden'), 400);
        },
        
        goToSlide(slideId) {
            const slideOrder = Array.from(this.elements.modalSidebarBtns).map(btn => btn.dataset.slide);
            this.currentSlideIndex = slideOrder.indexOf(slideId);
            if (this.currentSlideIndex === -1) this.currentSlideIndex = 0;
            
            this.elements.slides.forEach((slide) => {
                slide.classList.toggle('active', slide.dataset.slide === slideId);
            });
            this.elements.modalSidebarBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.slide === slideId);
            });
            this.elements.modalContentArea.scrollTop = 0;
        },
        
        changeSlide(direction) {
            const numSlides = this.elements.slides.length;
            this.currentSlideIndex = (this.currentSlideIndex + direction + numSlides) % numSlides;
            const newSlideId = this.elements.slides[this.currentSlideIndex].dataset.slide;
            this.goToSlide(newSlideId);
        }
    };

    app.init();
});
</script>
</body>
</html>